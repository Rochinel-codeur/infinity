"use strict";(()=>{var e={};e.id=540,e.ids=[540],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},20629:e=>{e.exports=require("fs/promises")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},33789:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>j,patchFetch:()=>q,requestAsyncStorage:()=>y,routeModule:()=>h,serverHooks:()=>R,staticGenerationAsyncStorage:()=>v});var n={};r.r(n),r.d(n,{DELETE:()=>w,GET:()=>m,POST:()=>f,PUT:()=>x});var s=r(49303),a=r(88716),o=r(60670),i=r(87070),u=r(90455),l=r(72331),c=r(20629),p=r(55315),d=r(46335);async function m(){if(!await (0,u.Rz)())return i.NextResponse.json({error:"Non autoris\xe9"},{status:401});try{let e=await l.Z.testimonial.findMany({orderBy:[{order:"asc"},{createdAt:"desc"}]});return i.NextResponse.json({testimonials:e})}catch(e){return console.error("Testimonials fetch error:",e),i.NextResponse.json({error:"Erreur serveur"},{status:500})}}async function g(e){let t=await e.arrayBuffer(),r=Buffer.from(t),n=`${(0,d.Z)()}-${e.name.replace(/[^a-zA-Z0-9.]/g,"")}`,s=(0,p.join)(process.cwd(),"public/uploads"),a=(0,p.join)(s,n);return await (0,c.writeFile)(a,r),`/uploads/${n}`}async function f(e){if(!await (0,u.Rz)())return i.NextResponse.json({error:"Non autoris\xe9"},{status:401});try{let t=await e.formData(),r=t.get("name"),n=t.get("text"),s=t.get("date"),a=t.get("source"),o=parseInt(t.get("rating"))||5,u="true"===t.get("isActive"),c=parseInt(t.get("order"))||0,p=t.get("imageUrl"),d=t.get("file");d&&d.size>0&&(p=await g(d));let m=await l.Z.testimonial.create({data:{name:r,text:n,date:new Date(s),source:a||"WhatsApp",imageUrl:p,rating:o,isActive:u,order:c}});return i.NextResponse.json({testimonial:m})}catch(e){return console.error("Testimonial create error:",e),i.NextResponse.json({error:"Erreur serveur"},{status:500})}}async function x(e){if(!await (0,u.Rz)())return i.NextResponse.json({error:"Non autoris\xe9"},{status:401});try{let t;let r=e.headers.get("content-type")||"",n={};if(r.includes("application/json")){let r=await e.json();t=r.id,void 0!==r.isActive&&(n.isActive=r.isActive),r.name&&(n.name=r.name),r.text&&(n.text=r.text),r.date&&(n.date=new Date(r.date)),void 0!==r.order&&(n.order=r.order)}else{let r=await e.formData();t=r.get("id");let s=r.get("name");s&&(n.name=s);let a=r.get("text");a&&(n.text=a);let o=r.get("date");o&&(n.date=new Date(o));let i=r.get("source");i&&(n.source=i);let u=r.get("rating");u&&(n.rating=parseInt(u));let l=r.get("isActive");null!==l&&(n.isActive="true"===l);let c=r.get("order");c&&(n.order=parseInt(c));let p=r.get("imageUrl"),d=r.get("file");d&&d.size>0&&(p=await g(d)),p&&(n.imageUrl=p)}if(!t)return i.NextResponse.json({error:"ID requis"},{status:400});let s=await l.Z.testimonial.update({where:{id:t},data:n});return i.NextResponse.json({testimonial:s})}catch(e){return console.error("Testimonial update error:",e),i.NextResponse.json({error:"Erreur serveur"},{status:500})}}async function w(e){if(!await (0,u.Rz)())return i.NextResponse.json({error:"Non autoris\xe9"},{status:401});try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return i.NextResponse.json({error:"ID requis"},{status:400});return await l.Z.testimonial.delete({where:{id:r}}),i.NextResponse.json({success:!0})}catch(e){return console.error("Testimonial delete error:",e),i.NextResponse.json({error:"Erreur serveur"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/testimonials/route",pathname:"/api/admin/testimonials",filename:"route",bundlePath:"app/api/admin/testimonials/route"},resolvedPagePath:"/home/guigui2401/Documents/Dev/infinity/app/api/admin/testimonials/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:y,staticGenerationAsyncStorage:v,serverHooks:R}=h,j="/api/admin/testimonials/route";function q(){return(0,o.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:v})}},90455:(e,t,r)=>{r.d(t,{RA:()=>p,Rz:()=>d,lO:()=>m,lm:()=>g,v9:()=>f});var n=r(71615),s=r(41482),a=r.n(s),o=r(98691),i=r(72331);let u=process.env.ADMIN_JWT_SECRET||"default-secret-change-me",l="admin_token";async function c(e,t){return o.ZP.compare(e,t)}function p(e){return a().sign(e,u,{expiresIn:"7d"})}async function d(){let e=await (0,n.cookies)(),t=e.get(l)?.value;return t?function(e){try{return a().verify(e,u)}catch{return null}}(t):null}async function m(e){(await (0,n.cookies)()).set(l,e,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"})}async function g(){(await (0,n.cookies)()).delete(l)}async function f(e,t){let r=await i.Z.admin.findUnique({where:{email:e}});return r&&await c(t,r.password)?{id:r.id,email:r.email,name:r.name,role:r.role}:null}},72331:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(53524);let s=globalThis.prisma??new n.PrismaClient({log:["error"]})},46335:(e,t,r)=>{r.d(t,{Z:()=>u});let n=require("node:crypto"),s={randomUUID:n.randomUUID},a=new Uint8Array(256),o=a.length,i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));let u=function(e,t,r){return!s.randomUUID||t||e?function(e,t,r){let s=(e=e||{}).random??e.rng?.()??(o>a.length-16&&((0,n.randomFillSync)(a),o=0),a.slice(o,o+=16));if(s.length<16)throw Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=s[e];return t}return function(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}(s)}(e,t,r):s.randomUUID()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972,80],()=>r(33789));module.exports=n})();