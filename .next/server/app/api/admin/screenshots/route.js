"use strict";(()=>{var e={};e.id=95,e.ids=[95],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},20629:e=>{e.exports=require("fs/promises")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},62269:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>j,patchFetch:()=>U,requestAsyncStorage:()=>w,routeModule:()=>y,serverHooks:()=>R,staticGenerationAsyncStorage:()=>v});var n={};r.r(n),r.d(n,{DELETE:()=>h,GET:()=>g,POST:()=>f,PUT:()=>x});var s=r(49303),o=r(88716),a=r(60670),i=r(87070),u=r(90455),c=r(72331),l=r(20629),p=r(55315),m=r(46335);async function d(e){try{let t=await e.arrayBuffer(),r=Buffer.from(t),n=`${(0,m.Z)()}-${e.name.replace(/[^a-zA-Z0-9.]/g,"")}`,s=(0,p.join)(process.cwd(),"public/uploads"),o=(0,p.join)(s,n);return await (0,l.writeFile)(o,r),`/uploads/${n}`}catch(e){return console.error("Upload error",e),null}}async function g(){if(!await (0,u.Rz)())return i.NextResponse.json({error:"Non autoris\xe9"},{status:401});try{let e=await c.Z.winningScreenshot.findMany({orderBy:[{order:"asc"},{createdAt:"desc"}]});return i.NextResponse.json({screenshots:e})}catch(e){return console.error(e),i.NextResponse.json({error:"Erreur serveur"},{status:500})}}async function f(e){if(!await (0,u.Rz)())return i.NextResponse.json({error:"Non autoris\xe9"},{status:401});try{let t=await e.formData(),r=t.get("name"),n=t.get("message"),s=t.get("amount"),o=t.get("time"),a=t.get("type")||"win",u="true"===t.get("isActive"),l=t.get("imageUrl"),p=t.get("file");if(p&&p.size>0){let e=await d(p);e&&(l=e)}let m=await c.Z.winningScreenshot.create({data:{name:r,message:n,amount:s,time:o,type:a,isActive:u,imageUrl:l}});return i.NextResponse.json({screenshot:m})}catch(e){return console.error("Create error",e),i.NextResponse.json({error:"Erreur serveur"},{status:500})}}async function x(e){if(!await (0,u.Rz)())return i.NextResponse.json({error:"Non autoris\xe9"},{status:401});try{let t;let r=e.headers.get("content-type")||"",n={};if(r.includes("application/json")){let r=await e.json();t=r.id,void 0!==r.isActive&&(n.isActive=r.isActive),r.name&&(n.name=r.name),r.message&&(n.message=r.message),r.amount&&(n.amount=r.amount),r.time&&(n.time=r.time),r.type&&(n.type=r.type)}else{let r=await e.formData();t=r.get("id");let s=r.get("name");s&&(n.name=s);let o=r.get("message");o&&(n.message=o);let a=r.get("amount");a&&(n.amount=a);let i=r.get("time");i&&(n.time=i);let u=r.get("type");u&&(n.type=u);let c=r.get("isActive");null!==c&&(n.isActive="true"===c);let l=r.get("imageUrl"),p=r.get("file");if(p&&p.size>0){let e=await d(p);e&&(l=e)}l&&(n.imageUrl=l)}if(!t)return i.NextResponse.json({error:"ID requis"},{status:400});let s=await c.Z.winningScreenshot.update({where:{id:t},data:n});return i.NextResponse.json({screenshot:s})}catch(e){return console.error("Update error",e),i.NextResponse.json({error:"Erreur serveur"},{status:500})}}async function h(e){if(!await (0,u.Rz)())return i.NextResponse.json({error:"Non autoris\xe9"},{status:401});try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return i.NextResponse.json({error:"ID requis"},{status:400});return await c.Z.winningScreenshot.delete({where:{id:r}}),i.NextResponse.json({success:!0})}catch(e){return console.error(e),i.NextResponse.json({error:"Erreur serveur"},{status:500})}}let y=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/screenshots/route",pathname:"/api/admin/screenshots",filename:"route",bundlePath:"app/api/admin/screenshots/route"},resolvedPagePath:"/home/guigui2401/Documents/Dev/infinity/app/api/admin/screenshots/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:w,staticGenerationAsyncStorage:v,serverHooks:R}=y,j="/api/admin/screenshots/route";function U(){return(0,a.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:v})}},90455:(e,t,r)=>{r.d(t,{RA:()=>p,Rz:()=>m,lO:()=>d,lm:()=>g,v9:()=>f});var n=r(71615),s=r(41482),o=r.n(s),a=r(98691),i=r(72331);let u=process.env.ADMIN_JWT_SECRET||"default-secret-change-me",c="admin_token";async function l(e,t){return a.ZP.compare(e,t)}function p(e){return o().sign(e,u,{expiresIn:"7d"})}async function m(){let e=await (0,n.cookies)(),t=e.get(c)?.value;return t?function(e){try{return o().verify(e,u)}catch{return null}}(t):null}async function d(e){(await (0,n.cookies)()).set(c,e,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"})}async function g(){(await (0,n.cookies)()).delete(c)}async function f(e,t){let r=await i.Z.admin.findUnique({where:{email:e}});return r&&await l(t,r.password)?{id:r.id,email:r.email,name:r.name,role:r.role}:null}},72331:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(53524);let s=globalThis.prisma??new n.PrismaClient({log:["error"]})},46335:(e,t,r)=>{r.d(t,{Z:()=>u});let n=require("node:crypto"),s={randomUUID:n.randomUUID},o=new Uint8Array(256),a=o.length,i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));let u=function(e,t,r){return!s.randomUUID||t||e?function(e,t,r){let s=(e=e||{}).random??e.rng?.()??(a>o.length-16&&((0,n.randomFillSync)(o),a=0),o.slice(a,a+=16));if(s.length<16)throw Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=s[e];return t}return function(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}(s)}(e,t,r):s.randomUUID()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972,80],()=>r(62269));module.exports=n})();