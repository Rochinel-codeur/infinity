"use strict";(()=>{var e={};e.id=504,e.ids=[504],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},20629:e=>{e.exports=require("fs/promises")},55315:e=>{e.exports=require("path")},88869:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>b,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var o={};r.r(o),r.d(o,{POST:()=>c});var n=r(49303),i=r(88716),s=r(60670),a=r(87070),u=r(72331),l=r(20629),p=r(55315),m=r(46335);async function c(e){try{let t=await e.formData();console.log("Received form data");let r=t.get("name"),o=t.get("text");console.log("Name:",r,"Text length:",o?.length);let n=parseInt(t.get("rating"))||5,i=t.get("image");if(i&&console.log("File received:",i.name,i.size,i.type),!r||!o)return a.NextResponse.json({error:"Champs manquants"},{status:400});let s=null;if(i&&i.size>0){let e=await i.arrayBuffer(),t=Buffer.from(e),r=`${(0,m.Z)()}-${i.name.replace(/[^a-zA-Z0-9.]/g,"")}`,o=(0,p.join)(process.cwd(),"public/uploads"),n=(0,p.join)(o,r);await (0,l.writeFile)(n,t),s=`/uploads/${r}`}return await u.Z.testimonial.create({data:{name:r,text:o,isActive:!1,source:"UserSubmission",date:new Date,rating:n,imageUrl:s}}),a.NextResponse.json({success:!0})}catch(e){return console.error("Submission error:",e),a.NextResponse.json({error:"Internal Error"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/testimonials/submit/route",pathname:"/api/testimonials/submit",filename:"route",bundlePath:"app/api/testimonials/submit/route"},resolvedPagePath:"/home/guigui2401/Documents/Dev/infinity/app/api/testimonials/submit/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:h}=d,x="/api/testimonials/submit/route";function b(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},72331:(e,t,r)=>{r.d(t,{Z:()=>n});var o=r(53524);let n=globalThis.prisma??new o.PrismaClient({log:["error"]})},46335:(e,t,r)=>{r.d(t,{Z:()=>u});let o=require("node:crypto"),n={randomUUID:o.randomUUID},i=new Uint8Array(256),s=i.length,a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));let u=function(e,t,r){return!n.randomUUID||t||e?function(e,t,r){let n=(e=e||{}).random??e.rng?.()??(s>i.length-16&&((0,o.randomFillSync)(i),s=0),i.slice(s,s+=16));if(n.length<16)throw Error("Random bytes length must be >= 16");if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase()}(n)}(e,t,r):n.randomUUID()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[948,972],()=>r(88869));module.exports=o})();